# Field descriptions used in multiple schemas
field_descriptions:
  - &station
    name: station
    description: >
      The 4-character station ID. See [station metadata](http://example.com/blob/main/_data/stations-formatted.csv).
    type: string
    unit:
    constraints:
      required: true
      pattern: "[A-Z]{4}"

  - &datetime
    name: datetime
    description: >
      UTC timestamp of record. For scan-level time series, this is the timestamp of the radar volume scan. For 5-minute time series, it is a regularly-spaced 5-minute timestamp.
    type: datetime
    unit:
    constraints:
      required: true
      
  - &solar_elevation
    name: solar_elevation
    description: >
      Sun elevation in degrees above horizon (negative for below horizon) at the radar station's location for the date and time of the record.
    type: number
    unit: degree
    constraints:
      required: true

  - &period_date
    name: period_date
    description: >
      The local date of the start of the period (night or day) to which the record belongs. See the `period` field.
    type: date
    unit:
    constraints:
      required: true

  - &period
    name: period
    description: >
      The period (night or day) to which the record belongs, as determined by the station's location and the date and time of the record.
    type: string
    unit:
    constraints:
      required: true
      enum: ["night", "day"]

  - &period_time
    name: period_time
    description: >
      Hours from the beginning of the period to the time of the current record. See the `period` field.
    type: number
    unit: h
    constraints:
      required: true
      minimum: 0.

  - &period_length
    name: period_length
    description: >
      Length of the period. See the `period` field.
    type: number
    unit: h
    constraints:
      required: true
      minimum: 0.

  - &reflectivity
    name: reflectivity
    description: >
      Vertically integrated reflectivity. Represents total radar cross section in <unit>cm^2</unit> in a vertical column above one square kilometer of the earth's surface. Only includes scattering volumes identified as biology.
    type: number
    unit: cm^2.km^{-2}
    constraints:
      minimum: 0.

  - &reflectivity_unfiltered
    name: reflectivity_unfiltered
    description: >
      Same as `reflectivity`, but includes all scattering volumes, including those classified as precipitation.
    type: number
    unit: cm^2.km^{-2}
    constraints:
      minimum: 0.

  - &traffic_rate
    name: traffic_rate
    description: >
      Reflectivity traffic rate, computed by vertically integrating reflectivity multiplied by speed. Represents total radar cross section in <unit>cm^2</unit> crossing over a one kilometer transect in one hour, where the transect is adaptively chosen for each height bin to be perpendicular to the mean direction of travel in that height bin. Only includes scattering volumes identified as biology.
    type: number
    unit: cm^2.km^{-1}.h^{-1}
    constraints:
      minimum: 0.

  - &traffic_rate_unfiltered
    name: traffic_rate_unfiltered
    description: >
      Same as `traffic_rate`, but includes all scattering volumes, including those classified as precipitation.
    type: number
    unit: cm^2.km^{-1}.h^{-1}
    constraints:
      minimum: 0.

  - &u
    name: u
    description: >
      Zonal (east-west) velocity component, computed as reflectivity-weighted average over height bins.
    type: number
    unit: m.s^{-1}

  - &v
    name: v
    description: >
      Meridional (north-south) velocity component, computed as reflectivity-weighted average over height bins.
    type: number
    unit: m.s^{-1}

  - &speed
    name: speed
    description: >
      Mean (ground) speed of travel, computed as reflectivity-weighted average over height bins. This represents the average speed of scatterers across elevation bins, regardless of direction. This is different from, and generally higher than, the magnitude of the reflectivity-weighted average velocities `u` and `v`, because 'cancellation' of objects moving in different directions can occur when averaging velocities.
    type: number
    unit: m.s^{-1}
    constraints:
      minimum: 0.

  - &direction
    name: direction
    description: >
      Mean direction of travel, computed directly from `u` and `v`. The angle is given as a compass bearing in degrees clockwise from north.
    type: number
    unit: degree
    constraints:
      minimum: 0.
      maximum: 360.

  - &fraction_rain
    name: fraction_rain
    description: >
      Fraction of scattering volumes classified as precipitation.
    type: number
    unit: fraction
    constraints:
      minimum: 0.
      maximum: 1.

  - &rmse
    name: rmse
    description: >
      Root-mean squared error of VVP fit, reflectivity-weighted average over height bins.
    type: number
    unit: m.s^{-1}
    constraints:
      minimum: 0.
  
  - &filled
    name: filled
    description: >
      Indicates whether the measurement fields are considered "filled". True if the nearest record in the original scan-level time series data is more than 10 minutes but less than one hour from the timestamp (`date`) of this record. (If the time to the nearest measurement in the original data is more than one hour, the measurement fields are left blank.)
    type: boolean
    trueValues: ["1"]
    falseValue: "0"


schemas:

  profile:
    title: Vertical Profile
    file: profile.json
    description: >
      A vertical profile of biological activity above a radar station.

      Missing values may occur when a height bin contains no scattering volumes for the relevant radar variable or, for velocity-related fields, if there are numerical issues during velocity profiling.

    missingValues: [""]
    fields:
      - name: bin_lower
        description: >
          Lower limit of height bin.
        type: integer
        unit: m
        constraints:
          required: true
          unique: true
          minimum: 0

      - name: height
        description: >
          Center point of height bin.
        type: integer
        unit: m
        constraints:
          required: true
          unique: true
          minimum: 0
          
      - name: linear_eta
        description: >
          Average linear reflectivity for height bin.
          Represents the radar cross section in <unit>cm^2</unit> per cubic kilometer of atmosphere.
        type: number
        unit: cm^2.km^{-3}
        constraints:
          minimum: 0.
          
      - name: nbins
        description: >
          Number of scattering volumes in height bin.
        type: integer
        unit:
        constraints:
          required: true
          minimum: 0
          
      - name: direction
        description: >
          Mean direction of travel. The angle is given as a compass bearing in degrees clockwise from north.
        type: number
        unit: degree
        constraints:
          minimum: 0.
          maximum: 360.
          
      - name: speed
        description: >
          Mean (ground) speed of travel.
        type: number
        unit: m.s^{-1}
        constraints:
          minimum: 0.
          
      - name: u
        description: >
          Zonal (east-west) velocity component.
        type: number
        unit: m.s^{-1}

      - name: v
        description: >
          Meridional (north-south) velocity component.
        type: number
        unit: m.s^{-1}

      - name: rmse
        description: >
          Root-mean squared error of VVP fit for scattering volumes in height bin.
        type: number
        unit: m.s^{-1}
        constraints:
          minimum: 0.
          
      - name: elev1
        description: >
          Elevation angle of lowest sweep.
        type: number
        unit: degree
        constraints:
          required: true
          minimum: 0.
          
      - name: nvolumes_gr35_e1
        description: >
          Number of scattering volumes with reflectivity factor exceeding 35 dBZ in lowest selected sweep.
        type: integer
        unit:
        constraints:
          required: true
          minimum: 0
          
      - name: elev2
        description: >
          Elevation angle of second lowest sweep.
        type: number
        unit: degree
        constraints:
          required: true
          minimum: 0.
          
      - name: nvolumes_gr35_e2
        description: >
          Number of scattering volumes with reflectivity factor exceeding 35 dBZ in second lowest selected sweep.
        type: integer
        unit:
        constraints:
          required: true
          minimum: 0
          
      - name: vcp
        description: >
          NEXRAD volume coverage pattern for scan. Examples are 31, 32, 35 (clear air),
          12, 212, 112, 215, 121 (precipitation).
        type: integer
        unit:
        constraints:
          required: true

          
      - name: linear_eta_unfiltered
        description: >
          Average reflectivity for all scattering volumes in height bin,
          including those classified as rain.
        type: number
        unit: cm^2.km^{-3}
        constraints:
          minimum: 0.

      - name: percent_rain
        description: >
          Fraction of scattering volumes in height bin classified as precipitation. This fraction is weighted toward regions closer to the radar in accordance to the density of scattering volumes, which are smaller and more densely packed at closer ranges. In the derived data products, this variable is renamed to `fraction_rain`. 
        type: number
        unit:
        constraints:
          minimum: 0.
          maximum: 1.


  scan:
    title: Scan-Level Time Series
    file: scan.json
    description: >
      A time series of biology measurements for radar volume scans.
      The measurements are obtained by vertically integrating the profile data.
      Missing values may rarely occur when a dependent variable in the profile is missing at all elevations.

    missingValues: [""]

    fields: 
      - *station
      - *datetime
      - *solar_elevation
      - *period_date
      - *period
      - *period_time
      - *period_length
      - *reflectivity
      - *reflectivity_unfiltered
      - *traffic_rate
      - *traffic_rate_unfiltered
      - *u
      - *v
      - *speed
      - *direction
      - *fraction_rain
      - *rmse

  5min:
    title: Five-Minute Time Series
    file: 5min.json
    description: >
      A time series of biological measurements for a single radar station at a
      regular 5-minute interval.
      
      Measurements are obtained by interpolating the Scan-Level Time Series to a
      5-minute time step.

    fields:
      - *station
      - *datetime
      - *solar_elevation
      - *period_date
      - *period
      - *period_time
      - *period_length
      - *reflectivity
      - *reflectivity_unfiltered
      - *traffic_rate
      - *traffic_rate_unfiltered
      - *u
      - *v
      - *speed
      - *direction
      - *fraction_rain
      - *rmse
      - *filled

    missingValues: [""]


  daily:
    title: Daily Time Series
    file: daily.json
    description: >
      A daily time series of biological measurements for an individual radar station.
      The measurements are obtained by aggregating the 5-minute time series to a daily time step for different periods (night, day, and calendar date).
      Missing values may occur if a variable is missing in the 5-minute time series for all records in the period.

    missingValues: [""]

    fields: 
      - name: station
        description: >
          The 4-character station ID. See [station metadata](http://example.com/blob/main/_data/stations-formatted.csv).
        type: string
        unit:
        constraints:
          required: true
          pattern: "[A-Z]{4}"

      - name: date
        description: >
          UTC date of the record.
        type: date
        unit:
        constraints:
          required: true

      - name: period
        description: >
          The period of the day (`night`, `day`, or `utc_calendar_day`) for which records of the 5-minute time series were aggregated to produce this record.
        type: string
        unit:
        constraints:
          required: true
          enum: ["night", "day", "utc_calendar_day"]

      - name: period_length
        description: >
          Length of the period. See the `period` field.
        type: number
        unit: h
        constraints:
          required: true
          minimum: 0.

      - name: fraction_missing
        description: >
          Fraction of 5-minute records in this period that were `missing` when aggregating.
        type: number
        unit:
        constraints:
          minimum: 0.
          maximum: 1.      

      - name: fraction_filled
        description: >
          Fraction of 5-minute records in this period that were `filled` in the 5-minute time series before aggregating.
        type: number
        unit:
        constraints:
          minimum: 0.
          maximum: 1.      

      - name: reflectivity_hours
        description: >
          Temporally and vertically integrated reflectivity. Represents accumulated hours of radar cross section in <unit>cm^2</unit> from a vertical column above one square kilometer of the earth's surface. Only includes scattering volumes identified as biology.
        type: number
        unit: cm^2.km^{-2}.h
        constraints:
          minimum: 0.

      - name: reflectivity_hours_unfiltered
        description: >
          Same as `reflectivity_hours`, but integrates `reflectivity_unfiltered` over time instead of `reflectivity`, so it includes measurements from all scattering volumes, including those identified as rain. 
        type: number
        unit: cm^2.km^{-2}.h
        constraints:
          minimum: 0.

      - name: traffic
        description: >
          Reflectivity traffic, computed by integrating `traffic_rate` over time. Represents total radar cross section in <unit>cm^2</unit> crossing over a one kilometer transect during the time period. Only includes scattering volumes identified as biology.
        type: number
        unit: cm^2.km^{-1}
        constraints:
          minimum: 0.
        
      - name: traffic_unfiltered
        description: >
          Same as `traffic`, but integrates `traffic_rate_unfiltered` over time instead of `traffic_rate`, so it includes measurements from all scattering volumes, including those identified as rain. 
        type: number
        unit: cm^2.km^{-1}
        constraints:
          minimum: 0.

      - name: u
        description: >
          Zonal (east-west) velocity component, computed as reflectivity-weighted average over the time period.
        type: number
        unit: m.s^{-1}

      - name: v
        description: >
          Meridional (north-south) velocity component, computed as reflectivity-weighted average over the time period.
        type: number
        unit: m.s^{-1}

      - name: direction
        description: >
          Mean direction of travel, computed as reflectivity-weighted average over the time period. The angle is given as a compass bearing in degrees clockwise from north.
        type: number
        unit: degree
        constraints:
          minimum: 0.
          maximum: 360.

      - name: speed
        description: >
          Mean (ground) speed of travel, computed as reflectivity-weighted average over the time period.
        type: number
        unit: m.s^{-1}
        constraints:
          minimum: 0.

      - name: fraction_rain
        description: >
          Fraction of scattering volumes classified as precipitation, computed as a simple average over the time period.
        type: number
        unit: 
        constraints:
          minimum: 0.
          maximum: 1.